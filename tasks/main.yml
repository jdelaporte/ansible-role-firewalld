---
- name: Install firewalld package
  yum: pkg=firewalld state=present

- name: Ensure firewalld is running and enabled on boot
  service: name=firewalld state=started enabled=yes


- name: Add firewalld zones and sources from vars
  firewalld:
    zone="{{ item.key }}"
    source="{% for fwsource in item.value.sources %} {{fwsource}} {% endfor %}"
    service="{% for fwservice in item.value.services %} {{fwservice}} {% endfor %}"
    state="{{ item.value.state }}"
    permanent="{{ item.value.permanent | default (True) }}"
  with_nested:
  - "{{ firewalld_zones.item.value.sources }}"
  - "{{ firewalld_zones.item.value.services }}"
  notify: firewalld reload

#- name: Add firewalld rules for services from vars
#  firewalld:
##    service={{ item.service }}
##    zone={{ item.zone | default ("public") }}
#    permanent={{ item.permanent | default (True) }}
#    state={{ item.state | default ("enabled") }}
#  with_dict: "{{ firewalld_allow_services }}"
#  notify: firewalld reload
#- name: Add firewalld rules for ports from vars
#  firewalld:
#    port={{ item.port }}
#    zone={{ item.zone | default ("public") }}
#    permanent={{ item.permanent | default (True) }}
#    state={{ item.state | default ("enabled") }}
#  with_dict: "{{ firewalld_allow_ports }}"
#  notify: firewalld reload
